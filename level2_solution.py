import binascii

from gmpy2 import gmpy2

from AITMCLAB.libnum import n2s, invmod
from Crypto.Random import random


def getpq(n, e, d):
    while True:
        k = e * d - 1
        g = random.randint(0, n)
        while k % 2 == 0:
            k = k // 2
            temp = gmpy2.powmod(g, k, n) - 1
            if gmpy2.gcd(temp, n) > 1 and temp != 0:
                return gmpy2.gcd(temp, n)


e2 = "0x20211011"
N = 13060606190646199509417869356893267164607938890520467870153612362923013181328713588734302032470871311119075018295743512432062027679699631486289048751940000390702928313128503683763312047588132600893624316613364968822882615394231293334096920586472306218844512060241241481071962559819156475871222605349887836439374595154871602789016066314352344801679678904320232245670077498309355518716202967364998882174699874635510699778392294962945740361706295834051212767581306434391702148346687634020223987189945847373798131306738716742431780536902027877938213541406416671341664326108536986035396556510051111175698573222348057823413
c = 12867372944375883854363336601880441267261705355537611760294299925805251244958240103275237526767967626730074533544706890152570845224299535823447617779959842661570202936662285154578650228980267458478400193880058527910444648593865055027425009398697715988558697215651204631228634120733447428080516613329058531236663341873013234313135976077554334823422466390163254186997490374590109457849311320742584122358371540895634091966591313413497495482065372727880557421434854495173567124523314584947473382926561943980624934914344101538583686153455093983696176534133992069883954123992059741137121203135256339471481299934993685690535
d = 9969657475998937469021465897161826708623848962701092023394784614730559602493770413573679466781102793745088550068463791427229873047301230783533330171649341852206511285454324446046951438301189101085097334718684813402290643815428591069394835359542986636301905444528572731817493783982522608575126245027219632378068945474676583057371930180586121841758249731437689732342352462199610389756420475424547263696944976526413386592689716075191720833223945876263580920598686018269885511355644771607916907644920921567133184039090637039399962053936720420717689164266788961705574424755953725616929893071733963534429106859309620585059

e = 15914069303469478985296031900096138686210691626298764671051513402315652347029310520321090661658475897916286419500322704067930668674914412307883782100648403045900183352937563718396725611487763139463550781345793379247065512809728533907031510876312340707456265195686508575669272358507805985809090526914742692976143110492662643061134152956918280648407073577994882755603040531527515069730183439937103163430813463617785925355580832784868432411925033506675117979373574755395089454602586924007062714815737517183001493233808535379400645074622299415897855024755149948418395437703490238468629392113068726513662136683200855626539
c2 = 9653438417109781006180300105965030770533923108438573417035236405223006643830833836848930593198565118145943104129405986622459386109109443225936482662709179567452692134122646722289469049850498371300719126764728901995261968830119093181464029349462835381381057841639247554016659408237757931516614410756700681681612363113386068247795154628119640820304439170561100229519496966306654942224840050178760290299291423392147951419027305446084327522074490702264790829918437889096135198899247119727418336608309180045229236116749597930330615358311162208113123716881427509985361593743207052472174899037471834858024035722508078491025

e2 = int(e2, 16)
q = getpq(N, e, d)
p = N // q
phi = (p-1) * (q-1)
d2 = invmod(e2, phi)
flag = gmpy2.powmod(c2, d2, N)
flag = n2s(int(flag))
print(flag)

msg = pow(c, d, N)
msg = n2s(msg)
print(msg)

